<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/common-head :: common-head">
</head>
<body>
    <h1>LineaComandas producto</h1>
    <div th:replace="fragments/navbar :: navbar"></div>
    <div class="container">
        <a th:href="@{/LineaComanda/lineaComanda-add}" class="btn btn-primary">Añadir LineaComanda</a>
        <form>
            <div class="form-row">
                <div class="form-group col-md-4">
                    <label for="userFilter">Buscar por Usuario</label>
                    <select class="form-control" id="userFilter" name="userFilter">
                        <option value="" selected>Seleccione un usuario</option>
                        <option th:each="user : ${users}" th:value="${user.id}" th:text="${user.userName}"></option>
                    </select>
                </div>
                <div class="form-group col-md-4">
                    <label for="bikeFilter">Buscar por producto</label>
                    <select class="form-control" id="bikeFilter" name="bikeFilter">
                        <option value="" selected>Seleccione una producto</option>
                        <option th:each="bike : ${producto}" th:value="${bike.id}" th:text="${bike.marca} + ' ' + ${bike.modelo}"></option>
                    </select>
                </div>
            </div>
        </form>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Usuario</th>
                    <th>producto</th>
                    <th>Fecha de entrada</th>
                    <th>Fecha de salida</th>
                    <th>Concepto</th>
                    <th>Descripción</th>
                    <th>Estado</th>
                    <th>Importe</th>
                    <th>IVA</th>
                    <th>Total</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="lineaComanda : ${lineaComanda}"> <!-- Corregir el nombre del atributo aquí -->
                    <td th:text="${lineaComanda.id}"></td>
                    <td th:text="${lineaComanda.user.userName} + ' ' + ${lineaComanda.user.userSurname}"></td>
                    <td th:text="${lineaComanda.producto.marca} + ' ' + ${lineaComanda.producto.modelo}"></td>
                    <td th:text="${lineaComanda.fecha}"></td>
                    <td th:text="${lineaComanda.fechaSalida}"></td>
                    <td th:text="${lineaComanda.concepto}"></td>
                    <td th:text="${lineaComanda.descripcion}"></td>
                    <td th:text="${lineaComanda.estado}"></td>
                    <td th:text="${lineaComanda.importe}"></td>
                    <td th:text="${lineaComanda.iva}"></td>
                    <td th:text="${lineaComanda.total}"></td>
                    <!-- Columna para el botón Editar -->
                    <td>
                        <a th:href="@{'LineaComanda/lineaComanda-edit/' + ${lineaComanda.id}}" class="btn btn-primary">Editar</a>
                    </td>
                    <!-- Columna para el botón Eliminar -->
                    <td>
                       <form th:action="@{'/lineaComanda/delete/' + ${lineaComanda.id}}" method="post">
                            <input type="hidden" name="_method" value="delete" />
                            <button type="submit" class="btn btn-danger">Eliminar</button>
                        </form>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <script>
        $(document).ready(function () {
            $('#userFilter').change(function () {
                filterlineaComandaes();
            });

            $('#bikeFilter').change(function () {
                filterlineaComandaes();
            });

            function filterlineaComandaes() {
                var userFilter = $('#userFilter').val();
                var bikeFilter = $('#bikeFilter').val();
                var url = '/LineaComanda/listado-lineaComanda';

                if (userFilter !== '' || bikeFilter !== '') {
                    url += '?';

                    if (userFilter !== '') {
                        url += 'userFilter=' + userFilter;
                    }

                    if (bikeFilter !== '') {
                        if (userFilter !== '') {
                            url += '&';
                        }
                        url += 'bikeFilter=' + bikeFilter;
                    }
                }

                window.location.href = url;
            }
        });
    </script>
</body>
</html>
